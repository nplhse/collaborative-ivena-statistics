{% extends '_layout_vertical.html.twig' %}

{% block title %}
    Transport Time – {{ scope_label(scope) }} – {{ parent() }}
{% endblock %}

{% block header %}
    {% embed '_embeds/header.html.twig' %}
        {% block header_after %}
            {{ include(('_includes/subnav_stats.html.twig')) }}
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block page_body %}
    {% set currentDim = dimType %}
    {% set limit = app.request.query.getInt('tt_limit', 5) %}
    {% set backUrl = path('app_stats_transport_time', app.request.query.all|merge({
        primaryType: scope.scopeType, primaryId: scope.scopeId, gran: scope.granularity, key: scope.periodKey,
    })) %}

    <div class="container-xl">
        <twig:Breadcrumbs :items="[
            { label: 'Statistics', path: path('app_stats_dashboard') },
            { label: 'Transport Time', path: path('app_stats_transport_time') },
            { label: 'Time Bucket Matrix' }
        ]" />

        <div class="d-flex align-items-center mb-3">
            <h2 class="page-title me-auto">
                {{ scope_label(scope) }}
            </h2>

            <twig:ScopePicker
                :scope="scope"
            />

            <div class="dropdown me-2">
                <button class="btn btn-outline dropdown-toggle" data-bs-toggle="dropdown" type="button">
                    {{ availableDimTypes[currentDim] ?? currentDim|capitalize }}
                </button>
                <div class="dropdown-menu dropdown-menu-end">
                    {% for value, label in availableDimTypes %}
                        {% set active = (value == currentDim) %}
                        <a class="dropdown-item {% if active %}active{% endif %}"
                           href="{{ path(
                               app.request.attributes.get('_route'),
                               app.request.query.all|merge({dim: value}),
                           ) }}">
                            {{ label }}
                        </a>
                    {% endfor %}
                </div>
            </div>

            <twig:GranularitySwitch
                :scope="scope"
                variant="dropdown"
                :showPeriod="true"
                :allowedOptions="['year', 'quarter', 'month', 'week']"
            />
        </div>

        <twig:TransportTimeDimMatrixChart
            :scope="scope"
            :dimType="dimType"
            :view="view"
            :limit="limit"
        />

        <twig:TransportTimeDimMatrixTable
            :scope="scope"
            :dimType="dimType"
            :view="view"
        />

        <div class="col-auto ms-auto d-print-none d-flex gap-2 mt-2">
            <a href="{{ backUrl }}" class="btn btn-outline-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" >
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12l6 6m-6-6l6-6"/>
                </svg>
                &nbsp;Back to transport time
            </a>
        </div>
    </div>
{% endblock %}
