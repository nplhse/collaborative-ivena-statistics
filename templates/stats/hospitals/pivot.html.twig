{% extends '@Shared/_layout_vertical.html.twig' %}

{% block title %}
    Hospital Pivot Analysis â€“ {{ parent() }}
{% endblock %}

{% block header %}
    {% embed '@Shared/_embeds/header.html.twig' %}
        {% block header_after %}
            {{ include(('@Shared/_includes/subnav_stats.html.twig')) }}
        {% endblock %}
    {% endembed %}
{% endblock %}

{% block page_body %}
    <div class="page-body">
        <div class="container-xl">
            <div
                class="card"
                data-controller="hospital-pivot"
                data-hospital-pivot-rows-value='{{ cubeRows|json_encode|e('html_attr') }}'
                data-hospital-pivot-dimensions-labels-value='{{ dimensions|json_encode|e('html_attr') }}'
                data-hospital-pivot-measures-labels-value='{{ measures|json_encode|e('html_attr') }}'
            >
                <div class="card-header">
                    <h3 class="card-title">Hospital Pivot Analysis</h3>
                </div>

                <div class="card-body">
                    <div class="row g-3 align-items-end">

                        <div class="col-sm-4">
                            <label class="form-label">Row dimension</label>
                            <select
                                class="form-select"
                                data-hospital-pivot-target="rowDimension"
                            >
                                {% for key, label in dimensions %}
                                    <option value="{{ key }}" {% if key == 'tier' %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-sm-4">
                            <label class="form-label">Column dimension</label>
                            <select
                                class="form-select"
                                data-hospital-pivot-target="columnDimension"
                            >
                                <option value="">None</option>
                                {% for key, label in dimensions %}
                                    <option value="{{ key }}" {% if key == 'location' %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-sm-3">
                            <label class="form-label">Measure</label>
                            <select
                                class="form-select"
                                data-hospital-pivot-target="measure"
                            >
                                {% for key, label in measures %}
                                    <option value="{{ key }}">{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mt-4 table-responsive">
                            <table
                                class="table table-striped card-table mb-0"
                                data-hospital-pivot-target="table"
                            >
                                <thead data-hospital-pivot-target="tableHead"></thead>
                                <tbody data-hospital-pivot-target="tableBody"></tbody>
                            </table>
                        </div>

                        <div class="col-sm-4">
                            <label class="form-check form-switch mt-3">
                                <input
                                    class="form-check-input"
                                    type="checkbox"
                                    data-hospital-pivot-target="showPercentages"
                                    checked
                                >
                                <span class="form-check-label">Show percentages</span>
                            </label>
                        </div>

                        <div class="col-sm-4">
                            <label class="form-check form-switch mt-3">
                                <input
                                    class="form-check-input"
                                    type="checkbox"
                                    data-hospital-pivot-target="heatmap"
                                >
                                <span class="form-check-label">Enable heatmap</span>
                            </label>
                        </div>

                        <div class="col-sm-4">
                            <select
                                class="form-select"
                                data-hospital-pivot-target="viewMode"
                            >
                                <option value="all">All hospitals</option>
                                <option value="participants">Only participating hospitals</option>
                                <option value="comparison">Comparison (All vs Participating)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div
                class="card mt-3"
                data-controller="hospital-pivot-chart"
                data-hospital-pivot-chart-rows-value='{{ cubeRows|json_encode|e('html_attr') }}'
                data-hospital-pivot-chart-dimensions-labels-value='{{ dimensions|json_encode|e('html_attr') }}'
                data-hospital-pivot-chart-measures-labels-value='{{ measures|json_encode|e('html_attr') }}'
            >
                <div class="card-body">
                    <div
                        id="hospital-pivot-chart"
                        data-hospital-pivot-chart-target="chart"
                        style="min-height: 320px;"
                    ></div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
